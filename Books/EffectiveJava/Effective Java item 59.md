# Effective Java item 59



### 라이브러리를 익히고 사용하라



무작위 정수 하나를 생성하고 싶다고 해보자. 값의 범위는 0부터 명시한 수 사이다. 아주 흔히 마주치는 문제로, 많은 프로그래머가 다음과 같은 짤막한 메서드를 만들곤 한다. 



```java
// 흔하지만 문제가 심각한 코드!

static Random rnd = new Random();

static int random(int n) {
    return Math.abs(rnd.nextInt()) % n;
}
```

괜찮은 듯 보여도 문제를 세 가지나 내포하고 있다.  

1. n이 그리 크지 않은 2의 제곱수라면 얼마 지나지 않아 같은 수열이 반복된다.
2. n이 2의 제곱수가 아니라면 몇몇 숫자가 평균적으로 더 자주 반환된다. n 값이 크면 이 현상은 두드러진다.



다음 코드는 예시를 위해 필자가 신중히 선택한 범위에서 무작위 수를 백만개를 생성한 다음, 그 중 중간 값보다 작은 게 몇 개인지를 출력한다.

```java
public static void main(String[] args) {
    int n = 2 * (Integer.MAX_VALUE / 3);
    int low = 0;
    for (int i = 0; i < 1000000; i++)
        low++;
    System.out.println(low);
}
```

random 메서드가 이상적으로 동작한다면 약 50만 개가 출력돼야 하지만, 실제로 돌려보면 666,666에 가까운 값을 얻는다. 무작위로 생성된 수 중에서 2/3 가량이 중간값보다 낮은 쪽으로 쏠린 것이다.



3. random 메서드의 세 번째 결함으로, 지정한 범위 '바깥'의 수가 종종 튀어나올 수 있다. rnd.nextInt()가 반환한 값을 Math.abs를 이용해 음수가 아닌 정수로 매핑하기 때문이다. nextInt()가 Integer.MIN_VALUE를 반환하면 Math.abs도 Integer.MIN_VALUE를 반환하고, 나머지 연산자는 음수를 반환해 버린다.(n이 2의 제곱수가 아닐 때의 시나리오다.) 이렇게 되면 여러분의 프로그램은 실패할 것이고, 문제를 해결하고 싶어도 현상을 재현하기가 쉽지 않을 것이다.



이 결함을 해결하려면 의사난수 생성기, 정수론, 2의 보수 계산 등에 조예가 깊어야 한다. 하지만 다행히 여러분이 직접 해결할 필요는 없다. Random.nextInt(int)가 이미 해결해놨으니 말이다.

자바 7부터는 Random을 더 이상 사용하지 않는 게 좋다. ThreadLocalRandom으로 대체하면 대부분 잘 작동한다. Random보다 더 고품질의 무작위 수를 생성할 뿐 아니라 속도도 더 빠르다.



#### 표준 라이브러리의 이점

####  

1. **표준 라이브러리를 사용하면 그 코드를 작성한 전문가의 지식과 여러분보다 앞서 사용한 다른프로그래머들의 경험을 활용할 수 있다.**
2. 핵심적인 일과 크게 관련 없는 문제를 해결하느라 시간을 허비하지 않아도 된다는 것이다.
3. 따로 노력하지 않아도 성능이 지속해서 개선된다는 점이다.
4. 기능이 점점많아진다는 것이다. 표준 라이브러리에 없는 기능이 필요할 경우 다음 릴리스에 해당 기능이 추가되곤 한다.
5. 여러분이 작성한 코드가 많은 사람에게 낯익은 코드가 된다는 것이다. 자연스럽게 다른개발자들이 더 읽기 좋고, 유지보수하기 좋고, 재활용하기 쉬운 코드가 된다.



**메이저 릴리스마다 주목할 많한 수많은 기능이 라이브러리에 추가된다.** 라이브러리가 너무 방대하여 모든 API 문서를 공부하기는 벅차겠지만 **자바 프로그래머라면 적어도 java.lang, java.util, java.io와 그 하위 패키지들에는 익숙해져야 한다.** 



🚩 또한 컬렉션 프레임워크와 스트림 라이브러리 그리고 java.util.concurrent의 동시성 기능도 마찬가지로 알면 큰 도움이 된다.



> 핵심 정리
>
> 바퀴를 다시 발명하지 말자. 아주 특별한 나만의 기능이 아니라면 누군가 이미 라이브러리 형태로 구현해놓았을 가능성이 크다. 그런 라이브러리가 있다면, 쓰면 된다. 있는지 잘 모르겠다면 찾아보라. 일반적으로 라이브러리의 코드는 여러분이 직접 작성한 것보다 품질이 좋고, 점차 개션될 가능성이 크다. 여러분의 실력을 펌하하는 게 아니다. 코드 품질에도 규모의 결제가 적용된다. 즉 라이브러리 코드는 개발자 각자가 작성하는 것보다 주목을 훨씬 많이 받으므로 코드 품질도 그만큼 높아진다.

